

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mesh generation with Gmsh &mdash; DOLFINx 0.10.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=15ca63c5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Visualization with PyVista" href="demo_pyvista.html" />
    <link rel="prev" title="Poisson equation" href="demo_mixed-topology.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            DOLFINx
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../demos.html">Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../demos.html#pdes-introductory">PDEs (introductory)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../demos.html#pdes-advanced">PDEs (advanced)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../demos.html#nonlinear-problems">Nonlinear problems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../demos.html#mesh-generation">Mesh generation</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Mesh generation with Gmsh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gmsh-model-builders">Gmsh model builders</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dolfinx-mesh-creation-and-file-output">DOLFINx mesh creation and file output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generate-meshes">Generate meshes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../demos.html#interpolation-io-and-visualisation">Interpolation, IO and visualisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../demos.html#advanced-iterative-solvers">Advanced iterative solvers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../demos.html#user-defined-and-advanced-finite-elements">User-defined and advanced finite elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../demos.html#parallel-communication-analysis">Parallel communication analysis</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../demos.html#list-of-all-demos">List of all demos</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="demo_poisson.html">Poisson equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_biharmonic.html">Biharmonic equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_cahn-hilliard.html">Cahn-Hilliard equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_stokes.html">Stokes equations using Taylor-Hood elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_elasticity.html">Elasticity using algebraic multigrid</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Mesh generation with Gmsh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gmsh-model-builders">Gmsh model builders</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dolfinx-mesh-creation-and-file-output">DOLFINx mesh creation and file output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generate-meshes">Generate meshes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="demo_helmholtz.html">Helmholtz equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_static-condensation.html">Static condensation of linear elasticity</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_pyvista.html">Visualization with PyVista</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_interpolation-io.html">Interpolation and IO</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_types.html">Solving PDEs with different scalar (float) types</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_lagrange_variants.html">Variants of Lagrange elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_tnt-elements.html">Creating TNT elements using Basix’s custom element interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_scattering_boundary_conditions.html">Electromagnetic scattering from a wire with scattering boundary conditions # noqa</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_pml.html">Electromagnetic scattering from a wire with perfectly matched layer condition # noqa</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_half_loaded_waveguide.html">Electromagnetic modal analysis for a waveguide</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_axis.html">Electromagnetic scattering from a sphere (axisymmetric)</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_navier-stokes.html">Divergence conforming discontinuous Galerkin method for the Navier–Stokes equations # noqa</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_mixed-poisson.html">Mixed formulation of the Poisson equation with a block-preconditioner/solver # noqa</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_pyamg.html">Solve the Poisson and linearised elasticity equations using pyamg</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_hdg.html">HDG scheme for the Poisson equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_mixed-topology.html">Poisson equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_comm-pattern.html">Parallel communication pattern analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer.html">Developer resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DOLFINx</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../demos.html">Demos</a></li>
      <li class="breadcrumb-item active">Mesh generation with Gmsh</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/demos/demo_gmsh.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="mesh-generation-with-gmsh">
<h1>Mesh generation with Gmsh<a class="headerlink" href="#mesh-generation-with-gmsh" title="Link to this heading"></a></h1>
<p>Copyright (C) 2020-2023 Garth N. Wells and Jørgen S. Dokken</p>
<p>This demo shows how to create meshes using the Gmsh Python interface.
It is implemented in <a class="reference download internal" download="" href="../_downloads/47634f247d22ee0b32df8f8c65b9f626/demo_gmsh.py"><code class="xref download docutils literal notranslate"><span class="pre">demo_gmsh.py</span></code></a>.</p>
<p>The Gmsh module is required for this demo.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mpi4py</span><span class="w"> </span><span class="kn">import</span> <span class="n">MPI</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">gmsh</span>  <span class="c1"># type: ignore</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dolfinx.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">XDMFFile</span><span class="p">,</span> <span class="n">gmshio</span>
</pre></div>
</div>
<section id="gmsh-model-builders">
<h2>Gmsh model builders<a class="headerlink" href="#gmsh-model-builders" title="Link to this heading"></a></h2>
<p>The following functions add Gmsh meshes to a ‘model’.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">gmsh_sphere</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Gmsh model of a sphere and tag sub entitites</span>
<span class="sd">    from all co-dimensions (peaks, ridges, facets and cells).</span>

<span class="sd">    Args:</span>
<span class="sd">        model: Gmsh model to add the mesh to.</span>
<span class="sd">        name: Name (identifier) of the mesh to add.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Gmsh model with a sphere mesh added.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setCurrent</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">sphere</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">addSphere</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Synchronize OpenCascade representation with gmsh model</span>
    <span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>

    <span class="c1"># Add physical tag for sphere</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_physical_group</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="n">sphere</span><span class="p">],</span> <span class="n">tag</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Embed all sub-entities from the GMSH model into the sphere and tag</span>
    <span class="c1"># them</span>
    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">getEntities</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">entity_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">entity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">]</span>
        <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">entity_ids</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sphere</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add_physical_group</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">entity_ids</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">dim</span><span class="p">)</span>

    <span class="c1"># Generate the mesh</span>
    <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>


<span class="k">def</span><span class="w"> </span><span class="nf">gmsh_sphere_minus_box</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Gmsh model of a sphere with a box from the sphere removed.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: Gmsh model to add the mesh to.</span>
<span class="sd">        name: Name (identifier) of the mesh to add.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Gmsh model with a sphere mesh added.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setCurrent</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">sphere_dim_tags</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">addSphere</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">box_dim_tags</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">addBox</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">model_dim_tags</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">cut</span><span class="p">([(</span><span class="mi">3</span><span class="p">,</span> <span class="n">sphere_dim_tags</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="n">box_dim_tags</span><span class="p">)])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>

    <span class="c1"># Add physical tag 1 for exterior surfaces</span>
    <span class="n">boundary</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">getBoundary</span><span class="p">(</span><span class="n">model_dim_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oriented</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">boundary_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">boundary</span><span class="p">]</span>
    <span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">boundary_ids</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setPhysicalName</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Sphere surface&quot;</span><span class="p">)</span>

    <span class="c1"># Add physical tag 2 for the volume</span>
    <span class="n">volume_entities</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">getEntities</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">volume_entities</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setPhysicalName</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Sphere volume&quot;</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>


<span class="k">def</span><span class="w"> </span><span class="nf">gmsh_ring</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Gmsh model of a ring-type geometry using hexahedral cells.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: Gmsh model to add the mesh to.</span>
<span class="sd">        name: Name (identifier) of the mesh to add.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Gmsh model with a sphere mesh added.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setCurrent</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Recombine tetrahedra to hexahedra</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;Mesh.RecombinationAlgorithm&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;Mesh.RecombineAll&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;Mesh.CharacteristicLengthFactor&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">circle</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">addDisk</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">circle_inner</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">addDisk</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">cut</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">cut</span><span class="p">([(</span><span class="mi">2</span><span class="p">,</span> <span class="n">circle</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="n">circle_inner</span><span class="p">)])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">extruded_geometry</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">extrude</span><span class="p">(</span><span class="n">cut</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">numElements</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">recombine</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>

    <span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">cut</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="n">tag</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setPhysicalName</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;2D cylinder&quot;</span><span class="p">)</span>
    <span class="n">boundary_entities</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">getEntities</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">other_boundary_entities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">boundary_entities</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">entity</span> <span class="o">!=</span> <span class="n">cut</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">other_boundary_entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">other_boundary_entities</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setPhysicalName</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Remaining boundaries&quot;</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setOrder</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">volume_entities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">extruded_geometry</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">volume_entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">volume_entities</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setPhysicalName</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Mesh volume&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</section>
<section id="dolfinx-mesh-creation-and-file-output">
<h2>DOLFINx mesh creation and file output<a class="headerlink" href="#dolfinx-mesh-creation-and-file-output" title="Link to this heading"></a></h2>
<p>The following function creates a DOLFINx mesh from a Gmsh model, and
cell and facets tags. The mesh and the tags are written to an XDMF file
for visualisation, e.g. using ParaView.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_mesh</span><span class="p">(</span><span class="n">comm</span><span class="p">:</span> <span class="n">MPI</span><span class="o">.</span><span class="n">Comm</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a DOLFINx from a Gmsh model and output to file.</span>

<span class="sd">    Args:</span>
<span class="sd">        comm: MPI communicator top create the mesh on.</span>
<span class="sd">        model: Gmsh model.</span>
<span class="sd">        name: Name (identifier) of the mesh to add.</span>
<span class="sd">        filename: XDMF filename.</span>
<span class="sd">        mode: XDMF file mode. &quot;w&quot; (write) or &quot;a&quot; (append).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mesh_data</span> <span class="o">=</span> <span class="n">gmshio</span><span class="o">.</span><span class="n">model_to_mesh</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mesh_data</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">if</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">cell_tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh_data</span><span class="o">.</span><span class="n">cell_tags</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_cells&quot;</span>
    <span class="k">if</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">facet_tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh_data</span><span class="o">.</span><span class="n">facet_tags</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_facets&quot;</span>
    <span class="k">if</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">ridge_tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh_data</span><span class="o">.</span><span class="n">ridge_tags</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_ridges&quot;</span>
    <span class="k">if</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">peak_tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh_data</span><span class="o">.</span><span class="n">peak_tags</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_peaks&quot;</span>
    <span class="k">with</span> <span class="n">XDMFFile</span><span class="p">(</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">mesh_data</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">create_connectivity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">mesh_data</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">create_connectivity</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">mesh_data</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">create_connectivity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write_mesh</span><span class="p">(</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">cell_tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write_meshtags</span><span class="p">(</span>
                <span class="n">mesh_data</span><span class="o">.</span><span class="n">cell_tags</span><span class="p">,</span>
                <span class="n">mesh_data</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                <span class="n">geometry_xpath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/Xdmf/Domain/Grid[@Name=&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;]/Geometry&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">facet_tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write_meshtags</span><span class="p">(</span>
                <span class="n">mesh_data</span><span class="o">.</span><span class="n">facet_tags</span><span class="p">,</span>
                <span class="n">mesh_data</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                <span class="n">geometry_xpath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/Xdmf/Domain/Grid[@Name=&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;]/Geometry&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">ridge_tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write_meshtags</span><span class="p">(</span>
                <span class="n">mesh_data</span><span class="o">.</span><span class="n">ridge_tags</span><span class="p">,</span>
                <span class="n">mesh_data</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                <span class="n">geometry_xpath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/Xdmf/Domain/Grid[@Name=&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;]/Geometry&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">peak_tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write_meshtags</span><span class="p">(</span>
                <span class="n">mesh_data</span><span class="o">.</span><span class="n">peak_tags</span><span class="p">,</span>
                <span class="n">mesh_data</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                <span class="n">geometry_xpath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/Xdmf/Domain/Grid[@Name=&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;]/Geometry&quot;</span><span class="p">,</span>
            <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="generate-meshes">
<h2>Generate meshes<a class="headerlink" href="#generate-meshes" title="Link to this heading"></a></h2>
<p>Create a Gmsh model and set the verbosity level.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gmsh</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;General.Terminal&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Create model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
</pre></div>
</div>
<p>First, we create a Gmsh model of a sphere using tetrahedral cells
(linear geometry), then create independent meshes on each MPI rank and
write each mesh to an XDMF file. The MPI rank is appended to the
filename since the meshes are not distributed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">gmsh_sphere</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;Sphere&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">setCurrent</span><span class="p">(</span><span class="s2">&quot;Sphere&quot;</span><span class="p">)</span>
<span class="n">create_mesh</span><span class="p">(</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_SELF</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;sphere&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;out_gmsh/mesh_rank_</span><span class="si">{</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="o">.</span><span class="n">rank</span><span class="si">}</span><span class="s2">.xdmf&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we create a Gmsh model of a sphere with a box removed and using
tetrahedral cells (linear geometry), then create a distributed mesh.
The distributed mesh is written to file. The write option <code class="docutils literal notranslate"><span class="pre">&quot;w&quot;</span></code> is
passed to create a new XDMF file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">gmsh_sphere_minus_box</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;Sphere minus box&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">setCurrent</span><span class="p">(</span><span class="s2">&quot;Sphere minus box&quot;</span><span class="p">)</span>
<span class="n">create_mesh</span><span class="p">(</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;ball_d1&quot;</span><span class="p">,</span> <span class="s2">&quot;out_gmsh/mesh.xdmf&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For the mesh of the sphere with a box remove, we can increase the
degree of the geometry representation to 2 (quadratic geometry
representation). The higher-order distributed mesh is appended to the
XDMF file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;General.Terminal&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setOrder</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;General.Terminal&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">create_mesh</span><span class="p">(</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;ball_d2&quot;</span><span class="p">,</span> <span class="s2">&quot;out_gmsh/mesh.xdmf&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we create a distributed mesh using hexahedral cells of
geometric degree 2, and append the mesh to the XDMF file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">gmsh_ring</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;Hexahedral mesh&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">setCurrent</span><span class="p">(</span><span class="s2">&quot;Hexahedral mesh&quot;</span><span class="p">)</span>
<span class="n">create_mesh</span><span class="p">(</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;hex_d2&quot;</span><span class="p">,</span> <span class="s2">&quot;out_gmsh/mesh.xdmf&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The generated meshes can be visualised using
<a class="reference external" href="https://www.paraview.org/">ParaView</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="demo_mixed-topology.html" class="btn btn-neutral float-left" title="Poisson equation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="demo_pyvista.html" class="btn btn-neutral float-right" title="Visualization with PyVista" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, FEniCS Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>