<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Variants of Lagrange elements &mdash; DOLFINx 0.6.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Creating TNT elements using Basix’s custom element interface" href="demo_tnt-elements.html" />
    <link rel="prev" title="Solving PDEs with different scalar (float) types" href="demo_types.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> DOLFINx
          </a>
              <div class="version">
                0.6.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../demos.html">Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../demos.html#introductory-demos">Introductory demos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../demos.html#advanced-demos">Advanced demos</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../demos.html#all-demos">All demos</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="demo_poisson.html">Poisson equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_cahn-hilliard.html">Cahn-Hilliard equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_stokes.html">Stokes equations with Taylor-Hood elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_elasticity.html">Elasticity</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_gmsh.html">Mesh generation with Gmsh</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_helmholtz.html">Helmholtz equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_static-condensation.html">Static condensation of linear elasticity</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_pyvista.html">Visualization with pyvista</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_interpolation-io.html">Interpolation and IO</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_types.html">Solving PDEs with different scalar (float) types</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Variants of Lagrange elements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#equispaced-points-vs-gll-points">Equispaced points vs GLL points</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wrapping-a-basix-element">Wrapping a Basix element</a></li>
<li class="toctree-l4"><a class="reference internal" href="#computing-the-error-of-an-interpolation">Computing the error of an interpolation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#available-lagrange-variants">Available Lagrange variants</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="demo_tnt-elements.html">Creating TNT elements using Basix’s custom element interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_scattering_boundary_conditions.html">Scattering from a wire with scattering boundary conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_pml.html">Scattering from a wire with perfectly matched layer condition</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_half_loaded_waveguide.html">Mode analysis for a half-loaded rectangular waveguide</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer.html">Developer resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DOLFINx</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../demos.html">Demos</a></li>
      <li class="breadcrumb-item active">Variants of Lagrange elements</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/demos/demo_lagrange_variants.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="variants-of-lagrange-elements">
<h1>Variants of Lagrange elements<a class="headerlink" href="#variants-of-lagrange-elements" title="Permalink to this heading"></a></h1>
<p>This demo (<a class="reference download internal" download="" href="../_downloads/4805c30fd9f5602435f2b34dad232ba2/demo_lagrange_variants.py"><code class="xref download docutils literal notranslate"><span class="pre">demo_lagrange_variants.py</span></code></a>) illustrates how to:</p>
<ul class="simple">
<li><p>Define finite elements directly using Basix</p></li>
<li><p>Create variants of Lagrange finite elements</p></li>
</ul>
<p>We begin this demo by importing everything we require.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">basix</span>
<span class="kn">import</span> <span class="nn">basix.ufl_wrapper</span>
<span class="kn">import</span> <span class="nn">ufl</span>
<span class="kn">from</span> <span class="nn">dolfinx</span> <span class="kn">import</span> <span class="n">fem</span><span class="p">,</span> <span class="n">mesh</span>
<span class="kn">from</span> <span class="nn">ufl</span> <span class="kn">import</span> <span class="n">ds</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">inner</span>

<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">from</span> <span class="nn">petsc4py.PETSc</span> <span class="kn">import</span> <span class="n">ScalarType</span>

<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">ScalarType</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Demo should only be executed with DOLFINx real mode&quot;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>In addition to the imports seen in other demos, we also import Basix
and its UFL wrapper directly. Basix is the element definition and
tabulation library that is used by FEniCSx.</p>
<section id="equispaced-points-vs-gll-points">
<h2>Equispaced points vs GLL points<a class="headerlink" href="#equispaced-points-vs-gll-points" title="Permalink to this heading"></a></h2>
<p>The basis function of Lagrange elements are defined by placing points
on the reference element, with each basis function equal to 1 at one
point and 0 at all the other points.</p>
<p>To demonstrate the influence of interpolation point position, we
create a degree 10 element on an interval using equally spaced points,
and plot the basis functions. We create this element using Basix’s
<a class="reference external" href="https://docs.fenicsproject.org/basix/main/python/demo/demo_create_and_tabulate.py.html"><code class="docutils literal notranslate"><span class="pre">create_element</span></code></a>
function.</p>
<p>Basix’s function <code class="docutils literal notranslate"><span class="pre">element.tabulate</span></code> returns a 4-dimensional array with
shape (derivatives, points, basis functions, value size). In this
example, we only tabulate the 0th derivative and the value size is
1, so we take the slice <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">:,</span> <span class="pre">:,</span> <span class="pre">0]</span></code> to get a 2-dimensional array.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">basix</span><span class="o">.</span><span class="n">ElementFamily</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">basix</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>
                               <span class="n">basix</span><span class="o">.</span><span class="n">LagrangeVariant</span><span class="o">.</span><span class="n">equispaced</span><span class="p">)</span>

<span class="n">pts</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">create_lattice</span><span class="p">(</span><span class="n">basix</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">basix</span><span class="o">.</span><span class="n">LatticeType</span><span class="o">.</span><span class="n">equispaced</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pts</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="k">if</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Skip this plotting in parallel</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">values</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">points</span><span class="p">],</span> <span class="s2">&quot;ko&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;demo_lagrange_variants_equispaced_10.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="The basis functions of a degree 10 Lagrange space defined usingequispaced points." src="../_images/demo_lagrange_variants_equispaced_10.png" /></p>
<p>The basis functions exhibit large peaks towards the ends of the
interval. This is known as <a class="reference external" href="https://en.wikipedia.org/wiki/Runge%27s_phenomenon">Runge’s
phenomenon</a>. The
amplitude of the peaks increases as the degree of the element is
increased.</p>
<p>To rectify this issue, we can create a ‘variant’ of a Lagrange element
that uses the <a class="reference external" href="https://en.wikipedia.org/wiki/Gaussian_quadrature#Gauss%E2%80%93Lobatto_rules">Gauss–Lobatto–Legendre (GLL)
points</a>
to define the basis functions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">basix</span><span class="o">.</span><span class="n">ElementFamily</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">basix</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>
                               <span class="n">basix</span><span class="o">.</span><span class="n">LagrangeVariant</span><span class="o">.</span><span class="n">gll_warped</span><span class="p">)</span>

<span class="n">values</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pts</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>

<span class="k">if</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Skip this plotting in parallel</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">values</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">points</span><span class="p">],</span> <span class="s2">&quot;ko&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;demo_lagrange_variants_gll_10.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="The basis functions of a degree 10 Lagrange space defined using GLLpoints." src="../_images/demo_lagrange_variants_gll_10.png" /></p>
<p>The points are clustered towards the endpoints of the interval, and
the basis functions do not exhibit Runge’s phenomenon.</p>
</section>
<section id="wrapping-a-basix-element">
<h2>Wrapping a Basix element<a class="headerlink" href="#wrapping-a-basix-element" title="Permalink to this heading"></a></h2>
<p>Elements created using Basix can be used directly with UFL via Basix’s
UFL wrapper.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">basix</span><span class="o">.</span><span class="n">ElementFamily</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">basix</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">triangle</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                               <span class="n">basix</span><span class="o">.</span><span class="n">LagrangeVariant</span><span class="o">.</span><span class="n">gll_warped</span><span class="p">)</span>
<span class="n">ufl_element</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">ufl_wrapper</span><span class="o">.</span><span class="n">BasixElement</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
</pre></div>
</div>
<p>The UFL element <code class="docutils literal notranslate"><span class="pre">ufl_element</span></code> can be used in the same way as an
element created directly in UFL. For example, we could <a class="reference internal" href="demo_poisson.html"><span class="doc std std-doc">solve a
Poisson problem</span></a> using this element.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">msh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span><span class="n">comm</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="p">,</span>
                            <span class="n">points</span><span class="o">=</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)),</span> <span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
                            <span class="n">cell_type</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">triangle</span><span class="p">,)</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">FunctionSpace</span><span class="p">(</span><span class="n">msh</span><span class="p">,</span> <span class="n">ufl_element</span><span class="p">)</span>

<span class="n">facets</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">locate_entities_boundary</span><span class="p">(</span><span class="n">msh</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="n">marker</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span>
                                                                      <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">2.0</span><span class="p">)))</span>

<span class="n">dofs</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">locate_dofs_topological</span><span class="p">(</span><span class="n">V</span><span class="o">=</span><span class="n">V</span><span class="p">,</span> <span class="n">entity_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">entities</span><span class="o">=</span><span class="n">facets</span><span class="p">)</span>

<span class="n">bc</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">dirichletbc</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ScalarType</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">dofs</span><span class="o">=</span><span class="n">dofs</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="n">V</span><span class="p">)</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TrialFunction</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TestFunction</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">SpatialCoordinate</span><span class="p">(</span><span class="n">msh</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">ufl</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.02</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">inner</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">*</span> <span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">inner</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">inner</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">ds</span>

<span class="n">problem</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">petsc</span><span class="o">.</span><span class="n">LinearProblem</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">bcs</span><span class="o">=</span><span class="p">[</span><span class="n">bc</span><span class="p">],</span> <span class="n">petsc_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ksp_type&quot;</span><span class="p">:</span> <span class="s2">&quot;preonly&quot;</span><span class="p">,</span> <span class="s2">&quot;pc_type&quot;</span><span class="p">:</span> <span class="s2">&quot;lu&quot;</span><span class="p">})</span>
<span class="n">uh</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="computing-the-error-of-an-interpolation">
<h2>Computing the error of an interpolation<a class="headerlink" href="#computing-the-error-of-an-interpolation" title="Permalink to this heading"></a></h2>
<p>To demonstrate how the choice of Lagrange variant can affect
computed results, we will compute the error when interpolating a
function into a finite element space. For this example, we define a
saw tooth wave that will be interpolated into a Lagrange space.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">saw_tooth</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.43</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span>
</pre></div>
</div>
<p>We begin by interpolating the saw tooth wave with the two Lagrange
elements, and plot the finite element interpolation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">create_unit_interval</span><span class="p">(</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">SpatialCoordinate</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
<span class="n">u_exact</span> <span class="o">=</span> <span class="n">saw_tooth</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="k">for</span> <span class="n">variant</span> <span class="ow">in</span> <span class="p">[</span><span class="n">basix</span><span class="o">.</span><span class="n">LagrangeVariant</span><span class="o">.</span><span class="n">equispaced</span><span class="p">,</span> <span class="n">basix</span><span class="o">.</span><span class="n">LagrangeVariant</span><span class="o">.</span><span class="n">gll_warped</span><span class="p">]:</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">basix</span><span class="o">.</span><span class="n">ElementFamily</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">basix</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">variant</span><span class="p">)</span>
    <span class="n">ufl_element</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">ufl_wrapper</span><span class="o">.</span><span class="n">BasixElement</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">FunctionSpace</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">ufl_element</span><span class="p">)</span>

    <span class="n">uh</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
    <span class="n">uh</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">saw_tooth</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Skip this plotting in parallel</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">51</span><span class="p">):</span>
                <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">cell</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">50</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">uh</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="p">[</span><span class="n">saw_tooth</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">],</span> <span class="s2">&quot;k--&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;function&quot;</span><span class="p">,</span> <span class="s2">&quot;approximation&quot;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">variant</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;demo_lagrange_variants_interpolation_</span><span class="si">{</span><span class="n">variant</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="" src="../_images/demo_lagrange_variants_interpolation_equispaced.png" />
<img alt="" src="../_images/demo_lagrange_variants_interpolation_gll_warped.png" /></p>
<p>The plots illustrate that Runge’s phenomenon leads to the
interpolation being less accurate when using the equispaced variant of
Lagrange compared to the GLL variant.</p>
<p>To quantify the error, we compute the interpolation error in the <span class="math notranslate nohighlight">\(L_2\)</span>
norm,</p>
<div class="math notranslate nohighlight">
\[\left\|u - u_h\right\|_2 = \left(\int_0^1 (u - u_h)^2\right)^{\frac{1}{2}},\]</div>
<p>where <span class="math notranslate nohighlight">\(u\)</span> is the function and <span class="math notranslate nohighlight">\(u_h\)</span> is its interpolation in the finite
element space. The following code uses UFL to compute the <span class="math notranslate nohighlight">\(L_2\)</span> error for
the equispaced and GLL variants. The <span class="math notranslate nohighlight">\(L_2\)</span> error for the GLL variant is
considerably smaller than the error for the equispaced variant.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">variant</span> <span class="ow">in</span> <span class="p">[</span><span class="n">basix</span><span class="o">.</span><span class="n">LagrangeVariant</span><span class="o">.</span><span class="n">equispaced</span><span class="p">,</span> <span class="n">basix</span><span class="o">.</span><span class="n">LagrangeVariant</span><span class="o">.</span><span class="n">gll_warped</span><span class="p">]:</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">basix</span><span class="o">.</span><span class="n">ElementFamily</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">basix</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">variant</span><span class="p">)</span>
    <span class="n">ufl_element</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">ufl_wrapper</span><span class="o">.</span><span class="n">BasixElement</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">FunctionSpace</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">ufl_element</span><span class="p">)</span>

    <span class="n">uh</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
    <span class="n">uh</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">saw_tooth</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">((</span><span class="n">u_exact</span> <span class="o">-</span> <span class="n">uh</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">allreduce</span><span class="p">(</span><span class="n">fem</span><span class="o">.</span><span class="n">assemble_scalar</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">SUM</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computed L2 interpolation error (</span><span class="si">{</span><span class="n">variant</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">,</span> <span class="n">error</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="available-lagrange-variants">
<h2>Available Lagrange variants<a class="headerlink" href="#available-lagrange-variants" title="Permalink to this heading"></a></h2>
<p>Basix supports numerous Lagrange variants, including:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.equispaced</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.gll_warped</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.gll_isaac</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.gll_centroid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.chebyshev_warped</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.chebyshev_isaac</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.chebyshev_centroid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.gl_warped</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.gl_isaac</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.gl_centroid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.legendre</span></code></p></li>
</ul>
<section id="equispaced-points">
<h3>Equispaced points<a class="headerlink" href="#equispaced-points" title="Permalink to this heading"></a></h3>
<p>The variant <code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.equispaced</span></code> defines an element
using equally spaced points on the cell.</p>
</section>
<section id="gll-points">
<h3>GLL points<a class="headerlink" href="#gll-points" title="Permalink to this heading"></a></h3>
<p>For intervals, quadrilaterals and hexahedra, the variants
<code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.gll_warped</span></code>, <code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.gll_isaac</span></code>
and <code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.gll_centroid</span></code> all define an element using
GLL-type points.</p>
<p>On triangles and tetrahedra, the three variants use different methods
to distribute points on the cell so that the points on each edge are
GLL points. The three methods used are described in <a class="reference external" href="https://docs.fenicsproject.org/basix/main/cpp/namespacebasix_1_1lattice.html">the Basix
documentation</a>.</p>
</section>
<section id="chebyshev-points">
<h3>Chebyshev points<a class="headerlink" href="#chebyshev-points" title="Permalink to this heading"></a></h3>
<p>The variants <code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.chebyshev_warped</span></code>,
<code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.chebyshev_isaac</span></code> and
<code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.chebyshev_centroid</span></code> can be used to define
elements using <a class="reference external" href="https://en.wikipedia.org/wiki/Chebyshev_nodes">Chebyshev
points</a>. As with GLL
points, these three variants are the same on intervals, quadrilaterals
and hexahedra, and vary on simplex cells.</p>
</section>
<section id="gl-points">
<h3>GL points<a class="headerlink" href="#gl-points" title="Permalink to this heading"></a></h3>
<p>The variants <code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.gl_warped</span></code>,
<code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.gl_isaac</span></code> and
<code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.gl_centroid</span></code> can be used to define elements
using <a class="reference external" href="https://en.wikipedia.org/wiki/Gaussian_quadrature#Gauss%E2%80%93Legendre_quadrature">Gauss-Legendre (GL)
points</a>.
GL points do not include the endpoints, hence this variant can only be
used for discontinuous elements.</p>
</section>
<section id="legendre-polynomials">
<h3>Legendre polynomials<a class="headerlink" href="#legendre-polynomials" title="Permalink to this heading"></a></h3>
<p>The variant <code class="docutils literal notranslate"><span class="pre">basix.LagrangeVariant.legendre</span></code> can be used to define a
Lagrange-like element whose basis functions are the orthonormal
Legendre polynomials. These polynomials are not defined using points
at the endpoints, so can also only be used for discontinuous elements.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="demo_types.html" class="btn btn-neutral float-left" title="Solving PDEs with different scalar (float) types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="demo_tnt-elements.html" class="btn btn-neutral float-right" title="Creating TNT elements using Basix’s custom element interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, FEniCS Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>