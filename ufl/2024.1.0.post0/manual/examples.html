<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Example forms &#8212; Unified Form Language (UFL) 2024.1.0.post0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=c2f48ab3"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Internal representation details" href="internal_representation.html" />
    <link rel="prev" title="Form language" href="form_language.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="example-forms">
<h1>Example forms<a class="headerlink" href="#example-forms" title="Permalink to this heading">¶</a></h1>
<p>The following examples illustrate basic usage of the form language
for the definition of a collection of standard multilinear forms. We
assume that <code class="docutils literal notranslate"><span class="pre">dx</span></code> has been declared as an integral over the interior of
<span class="math notranslate nohighlight">\(\Omega\)</span> and that both <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">j</span></code> have been declared as a free
<code class="docutils literal notranslate"><span class="pre">Index</span></code>.</p>
<p>The examples presented below can all be found in the subdirectory
<code class="docutils literal notranslate"><span class="pre">demo/</span></code> of the UFL source tree together with numerous
other examples.</p>
<section id="the-mass-matrix">
<h2>The mass matrix<a class="headerlink" href="#the-mass-matrix" title="Permalink to this heading">¶</a></h2>
<p>As a first example, consider the bilinear form corresponding to a
mass matrix,</p>
<div class="math notranslate nohighlight">
\[a(v, u) = \int_{\Omega} v \, u \mathop{dx},\]</div>
<p>which can be implemented in UFL as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>This example is implemented in the file <code class="docutils literal notranslate"><span class="pre">Mass.py</span></code> in the collection
of demonstration forms included with the UFL source distribution.</p>
</section>
<section id="poisson-equation">
<h2>Poisson equation<a class="headerlink" href="#poisson-equation" title="Permalink to this heading">¶</a></h2>
<p>The bilinear and linear forms form for Poisson’s equation,</p>
<div class="math notranslate nohighlight">
\[\begin{split}a(v, u) &amp;= \int_{\Omega} \nabla v \cdot \nabla u \mathop{dx}, \\
L(v; f) &amp;= \int_{\Omega} v \, f \mathop{dx},\end{split}\]</div>
<p>can be implemented as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>Alternatively, index notation can be used to express the scalar product
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">Dx</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">Dx</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>or like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>This example is implemented in the file <code class="docutils literal notranslate"><span class="pre">Poisson.py</span></code> in the collection
of demonstration forms included with the UFL source distribution.</p>
</section>
<section id="vector-valued-poisson">
<h2>Vector-valued Poisson<a class="headerlink" href="#vector-valued-poisson" title="Permalink to this heading">¶</a></h2>
<p>The bilinear and linear forms for a system of (independent) Poisson
equations,</p>
<div class="math notranslate nohighlight">
\[\begin{split}a(v, u) &amp;= \int_{\Omega} \nabla v : \nabla u \mathop{dx}, \\
L(v; f) &amp;= \int_{\Omega} v \cdot f \mathop{dx},\end{split}\]</div>
<p>with <span class="math notranslate nohighlight">\(v\)</span>, <span class="math notranslate nohighlight">\(u\)</span> and <span class="math notranslate nohighlight">\(f\)</span> vector-valued can be implemented
as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="o">=</span> <span class="n">VectorElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">inner</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>Alternatively, index notation may be used like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">Dx</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Dx</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>or like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>This example is implemented in the file <code class="docutils literal notranslate"><span class="pre">PoissonSystem.py</span></code> in
the collection of demonstration forms included with the UFL source
distribution.</p>
</section>
<section id="the-strain-strain-term-of-linear-elasticity">
<h2>The strain-strain term of linear elasticity<a class="headerlink" href="#the-strain-strain-term-of-linear-elasticity" title="Permalink to this heading">¶</a></h2>
<p>The strain-strain term of linear elasticity,</p>
<div class="math notranslate nohighlight">
\[a(v, u) = \int_{\Omega} \epsilon(v) : \epsilon(u) \mathop{dx},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\epsilon(v) = \frac{1}{2}(\nabla v + (\nabla v)^{\top})\]</div>
<p>can be implemented as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="o">=</span> <span class="n">VectorElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">tetrahedron</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">epsilon</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">Dv</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Dv</span> <span class="o">+</span> <span class="n">Dv</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">inner</span><span class="p">(</span><span class="n">epsilon</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">epsilon</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>Alternatively, index notation can be used to define the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">Dx</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">Dx</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">))</span><span class="o">*</span> \
         <span class="p">(</span><span class="n">Dx</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">Dx</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>or like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="o">*</span> \
         <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>This example is implemented in the file <code class="docutils literal notranslate"><span class="pre">Elasticity.py</span></code> in the
collection of demonstration forms included with the UFL source
distribution.</p>
</section>
<section id="the-nonlinear-term-of-navier-stokes">
<h2>The nonlinear term of Navier–Stokes<a class="headerlink" href="#the-nonlinear-term-of-navier-stokes" title="Permalink to this heading">¶</a></h2>
<p>The bilinear form for fixed-point iteration on the nonlinear term of
the incompressible Navier–Stokes equations,</p>
<div class="math notranslate nohighlight">
\[a(v, u; w) = \int_{\Omega} (w \cdot \nabla u) \cdot v \mathop{dx},\]</div>
<p>with <span class="math notranslate nohighlight">\(w\)</span> the frozen velocity from a previous iteration, can be
implemented as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="o">=</span> <span class="n">VectorElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">tetrahedron</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>alternatively using index notation like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">Dx</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>or like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>This example is implemented in the file <code class="docutils literal notranslate"><span class="pre">NavierStokes.py</span></code> in
the collection of demonstration forms included with the UFL source
distribution.</p>
</section>
<section id="the-heat-equation">
<h2>The heat equation<a class="headerlink" href="#the-heat-equation" title="Permalink to this heading">¶</a></h2>
<p>Discretizing the heat equation,</p>
<div class="math notranslate nohighlight">
\[\dot{u} - \nabla \cdot (c \nabla u) = f,\]</div>
<p>in time using the <span class="math notranslate nohighlight">\(\mathrm{dG}(0)\)</span> method (backward Euler), we
obtain the following variational problem for the discrete solution <span class="math notranslate nohighlight">\(u_h
= u_h(x, t)\)</span>: Find <span class="math notranslate nohighlight">\(u_h^n = u_h(\cdot, t_n)\)</span> with
<span class="math notranslate nohighlight">\(u_h^{n-1} = u_h(\cdot, t_{n-1})\)</span> given such that</p>
<div class="math notranslate nohighlight">
\[\frac{1}{k_n} \int_{\Omega} v \, (u_h^n - u_h^{n-1}) \mathop{dx} +
\int_{\Omega} c \, \nabla v \cdot \nabla u_h^n \mathop{dx} =
\int_{\Omega} v \, f^n \mathop{dx}\]</div>
<p>for all test functions <span class="math notranslate nohighlight">\(v\)</span>, where <span class="math notranslate nohighlight">\(k_n = t_n - t_{n-1}\)</span>
denotes the time step. In the example below, we implement this
variational problem with piecewise linear test and trial functions,
but other choices are possible (just choose another finite element).</p>
<p>Rewriting the variational problem in the standard form <span class="math notranslate nohighlight">\(a(v, u_h)
= L(v)\)</span> for all <span class="math notranslate nohighlight">\(v\)</span>, we obtain the following pair of bilinear and
linear forms:</p>
<div class="math notranslate nohighlight">
\[\begin{split}a(v, u_h^n; c, k) &amp;= \int_{\Omega} v \, u_h^n \mathop{dx} +
k_n \int_{\Omega} c \, \nabla v \cdot \nabla u_h^n \mathop{dx}, \\
L(v; u_h^{n-1}, f, k) &amp;= \int_{\Omega} v \, u_h^{n-1} \mathop{dx} + k_n \int_{\Omega} v \, f^n \mathop{dx},\end{split}\]</div>
<p>which can be implemented as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">v</span>  <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>  <span class="c1"># Test function</span>
<span class="n">u1</span> <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="c1"># Value at t_n</span>
<span class="n">u0</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>   <span class="c1"># Value at t_n-1</span>
<span class="n">c</span>  <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>   <span class="c1"># Heat conductivity</span>
<span class="n">f</span>  <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>   <span class="c1"># Heat source</span>
<span class="n">k</span>  <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="s2">&quot;triangle&quot;</span><span class="p">)</span>   <span class="c1"># Time step</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="n">u1</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">u1</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="n">u0</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>This example is implemented in the file <code class="docutils literal notranslate"><span class="pre">Heat.py</span></code> in the collection
of demonstration forms included with the UFL source distribution.</p>
</section>
<section id="mixed-formulation-of-stokes">
<h2>Mixed formulation of Stokes<a class="headerlink" href="#mixed-formulation-of-stokes" title="Permalink to this heading">¶</a></h2>
<p>To solve Stokes’ equations,</p>
<div class="math notranslate nohighlight">
\[\begin{split}- \Delta u + \nabla p &amp;= f, \\
\nabla \cdot u &amp;= 0,\end{split}\]</div>
<p>we write the variational problem in standard form <span class="math notranslate nohighlight">\(a(v, u) =
L(v)\)</span> for all <span class="math notranslate nohighlight">\(v\)</span> to obtain the following pair of bilinear and
linear forms:</p>
<div class="math notranslate nohighlight">
\[\begin{split}a((v, q), (u, p)) &amp;= \int_{\Omega} \nabla v : \nabla u - (\nabla \cdot v) \, p +
q \, (\nabla \cdot u) \mathop{dx}, \\
L((v, q); f) &amp;= \int_{\Omega} v \cdot f \mathop{dx}.\end{split}\]</div>
<p>Using a mixed formulation with Taylor-Hood elements, this can be
implemented as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cell</span> <span class="o">=</span> <span class="n">triangle</span>
<span class="n">P2</span> <span class="o">=</span> <span class="n">VectorElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">P1</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">TH</span> <span class="o">=</span> <span class="n">P2</span> <span class="o">*</span> <span class="n">P1</span>

<span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="n">TestFunctions</span><span class="p">(</span><span class="n">TH</span><span class="p">)</span>
<span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">=</span> <span class="n">TrialFunctions</span><span class="p">(</span><span class="n">TH</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">P2</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">inner</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">))</span> <span class="o">-</span> <span class="n">div</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="n">q</span><span class="o">*</span><span class="n">div</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>This example is implemented in the file <code class="docutils literal notranslate"><span class="pre">Stokes.py</span></code> in the collection
of demonstration forms included with the UFL source distribution.</p>
</section>
<section id="mixed-formulation-of-poisson">
<h2>Mixed formulation of Poisson<a class="headerlink" href="#mixed-formulation-of-poisson" title="Permalink to this heading">¶</a></h2>
<p>We next consider the following formulation of Poisson’s equation as a
pair of first order equations for <span class="math notranslate nohighlight">\(\sigma \in H(\mathrm{div})\)</span>
and <span class="math notranslate nohighlight">\(u \in L^2\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\sigma + \nabla u &amp;= 0, \\
\nabla \cdot \sigma &amp;= f.\end{split}\]</div>
<p>We multiply the two equations by a pair of test functions <span class="math notranslate nohighlight">\(\tau\)</span> and
<span class="math notranslate nohighlight">\(w\)</span> and integrate by parts to obtain the following variational
problem: Find <span class="math notranslate nohighlight">\((\sigma, u) \in V = H(\mathrm{div}) \times L^2\)</span> such that</p>
<div class="math notranslate nohighlight">
\[a((\tau, w), (\sigma, u)) = L((\tau, w)) \quad \forall \, (\tau, w) \in V,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}a((\tau, w), (\sigma, u)) &amp;= \int_{\Omega} \tau \cdot \sigma - \nabla \cdot \tau \, u
+ w \nabla \cdot \sigma \mathop{dx},
\\
L((\tau, w); f) &amp;= \int_{\Omega} w \cdot f \mathop{dx}.\end{split}\]</div>
<p>We may implement the corresponding forms in our form language using
first order BDM H(div)-conforming elements for
<span class="math notranslate nohighlight">\(\sigma\)</span> and piecewise constant <span class="math notranslate nohighlight">\(L^2\)</span>-conforming elements for
<span class="math notranslate nohighlight">\(u\)</span> as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cell</span> <span class="o">=</span> <span class="n">triangle</span>
<span class="n">BDM1</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Brezzi-Douglas-Marini&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">DG0</span>  <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Discontinuous Lagrange&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">element</span> <span class="o">=</span> <span class="n">BDM1</span> <span class="o">*</span> <span class="n">DG0</span>

<span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="n">TestFunctions</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="o">=</span> <span class="n">TrialFunctions</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">DG0</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">-</span> <span class="n">div</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">w</span><span class="o">*</span><span class="n">div</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>This example is implemented in the file <code class="docutils literal notranslate"><span class="pre">MixedPoisson.py</span></code> in
the collection of demonstration forms included with the UFL source
distribution.</p>
</section>
<section id="poisson-equation-with-dg-elements">
<h2>Poisson equation with DG elements<a class="headerlink" href="#poisson-equation-with-dg-elements" title="Permalink to this heading">¶</a></h2>
<p>We consider again Poisson’s equation, but now in an (interior penalty)
discontinuous Galerkin formulation: Find <span class="math notranslate nohighlight">\(u \in V = L^2\)</span> such that</p>
<div class="math notranslate nohighlight">
\[a(v, u) = L(v) \quad \forall v \in V,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}a(v, u; h) &amp;= \int_{\Omega} \nabla v \cdot \nabla u \mathop{dx} \\
&amp;+ \sum_S \int_S
- \langle \nabla v \rangle \cdot [[ u ]]_n
- [[ v ]]_n \cdot \langle \nabla u \rangle
+ (\alpha/h) [[ v ]]_n \cdot [[ u ]]_n \mathop{dS} \\
&amp;+ \int_{\partial\Omega}
- \nabla v \cdot [[ u ]]_n - [[ v ]]_n \cdot \nabla u
+ (\gamma/h) v u \mathop{ds} \\
L(v; f, g) &amp;= \int_{\Omega} v f \mathop{dx} + \int_{\partial\Omega} v g \mathop{ds}.\end{split}\]</div>
<p>The corresponding finite element variational problem for discontinuous
first order elements may be implemented as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cell</span> <span class="o">=</span> <span class="n">triangle</span>
<span class="n">DG1</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Discontinuous Lagrange&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">DG1</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">DG1</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">DG1</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">DG1</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">Circumradius</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span> \
  <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="n">avg</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">)),</span> <span class="n">jump</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">dS</span> \
  <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="n">jump</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">avg</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">)))</span><span class="o">*</span><span class="n">dS</span> \
  <span class="o">+</span> <span class="n">alpha</span><span class="o">/</span><span class="n">h</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">jump</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">jump</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">dS</span> \
  <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">jump</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">ds</span> \
  <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="n">jump</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">ds</span> \
  <span class="o">+</span> <span class="n">gamma</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">ds</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">ds</span>
</pre></div>
</div>
<p>This example is implemented in the file <code class="docutils literal notranslate"><span class="pre">PoissonDG.py</span></code> in
the collection of demonstration forms included with the UFL source
distribution.</p>
</section>
<section id="the-quadrature-family">
<h2>The Quadrature family<a class="headerlink" href="#the-quadrature-family" title="Permalink to this heading">¶</a></h2>
<p>We consider here a nonlinear version of the Poisson’s equation to
illustrate the main point of the <code class="docutils literal notranslate"><span class="pre">Quadrature</span></code> finite element
family. The strong equation looks as follows:</p>
<div class="math notranslate nohighlight">
\[- \nabla \cdot (1+u^2)\nabla u = f.\]</div>
<p>The linearised bilinear and linear forms for this equation,</p>
<div class="math notranslate nohighlight">
\[\begin{split}a(v, u; u_0) &amp;= \int_{\Omega} (1+u_{0}^2) \nabla v \cdot \nabla u \mathop{dx}
+ \int_{\Omega} 2u_0 u \nabla v \cdot \nabla u_0 \mathop{dx},
\\
L(v; u_0, f)    &amp;= \int_{\Omega} v \, f \mathop{dx}
- \int_{\Omega} (1+u_{0}^2) \nabla v \cdot \nabla u_0 \mathop{dx},\end{split}\]</div>
<p>can be implemented in a single form file as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">u0</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">u0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">u0</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">u0</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">dx</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">u0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">u0</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>Here, <span class="math notranslate nohighlight">\(u_0\)</span> represents the solution from the previous Newton-Raphson
iteration.</p>
<p>The above form will be denoted REF1 and serves as our reference
implementation for linear elements. A similar form (REF2) using quadratic
elements will serve as a reference for quadratic elements.</p>
<p>Now, assume that we want to treat the quantities <span class="math notranslate nohighlight">\(C = (1 + u_{0}^2)\)</span>
and <span class="math notranslate nohighlight">\(\sigma_0 = (1+u_{0}^2) \nabla u_0\)</span> as given functions (to be
computed elsewhere). Substituting into the bilinear and linear forms, we obtain</p>
<div class="math notranslate nohighlight">
\[\begin{split}a(v, u) &amp;= \int_{\Omega} \text{C} \nabla v \cdot \nabla u \mathop{dx}
+ \int_{\Omega} 2u_0 u \nabla v \cdot \nabla u_0 \mathop{dx},
\\
L(v; \sigma_0, f)    &amp;= \int_{\Omega} v \, f \mathop{dx}
- \int_{\Omega} \nabla v \cdot \sigma_0 \mathop{dx}.\end{split}\]</div>
<p>Then, two additional forms are created to compute the tangent C and
the gradient of <span class="math notranslate nohighlight">\(u_0\)</span>. This situation shows up in plasticity and
other problems where certain quantities need to be computed elsewhere
(in user-defined functions).  The three forms using the standard
<code class="docutils literal notranslate"><span class="pre">FiniteElement</span></code> (linear elements) can then be implemented as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># NonlinearPoisson.py</span>
<span class="kn">from</span> <span class="nn">ufl</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">element</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">DG</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Discontinuous Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">sig</span> <span class="o">=</span> <span class="n">VectorElement</span><span class="p">(</span><span class="s2">&quot;Discontinuous Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">v</span>    <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">u</span>    <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">u0</span>   <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="n">C</span>    <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">DG</span><span class="p">)</span>
<span class="n">sig0</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
<span class="n">f</span>    <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">C</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">u0</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">u0</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">sig0</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tangent.py</span>
<span class="kn">from</span> <span class="nn">ufl</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">element</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">DG</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Discontinuous Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">DG</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">DG</span><span class="p">)</span>
<span class="n">u0</span><span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">u0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gradient.py</span>
<span class="kn">from</span> <span class="nn">ufl</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">element</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">DG</span> <span class="o">=</span> <span class="n">VectorElement</span><span class="p">(</span><span class="s2">&quot;Discontinuous Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">DG</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">DG</span><span class="p">)</span>
<span class="n">u0</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">u0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">grad</span><span class="p">(</span><span class="n">u0</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span>
</pre></div>
</div>
<p>The three forms can be implemented using the <code class="docutils literal notranslate"><span class="pre">QuadratureElement</span></code>
in a similar fashion in which only the element declaration is different:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># QE1NonlinearPoisson.py</span>
<span class="kn">from</span> <span class="nn">ufl</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">element</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">QE</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Quadrature&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">sig</span> <span class="o">=</span> <span class="n">VectorElement</span><span class="p">(</span><span class="s2">&quot;Quadrature&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># QE1Tangent.py</span>
<span class="kn">from</span> <span class="nn">ufl</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">element</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">QE</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Quadrature&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># QE1Gradient.py</span>
<span class="kn">from</span> <span class="nn">ufl</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">element</span> <span class="o">=</span> <span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">QE</span> <span class="o">=</span> <span class="n">VectorElement</span><span class="p">(</span><span class="s2">&quot;Quadrature&quot;</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that we use two points when declaring the <code class="docutils literal notranslate"><span class="pre">QuadratureElement</span></code>. This
is because the RHS of <code class="docutils literal notranslate"><span class="pre">Tangent.form</span></code> is second order and therefore
we need two points for exact integration. Due to consistency issues,
when passing functions around between the forms, we also need to use
two points when declaring the <code class="docutils literal notranslate"><span class="pre">QuadratureElement</span></code> in the other forms.</p>
<p>Typical values of the relative residual for each Newton iteration for all
three approaches are shown in the table below. It is to be noted
that the convergence rate is quadratic as it should be for all three methods.</p>
<p>Relative residuals for each approach for linear elements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Iteration</span> <span class="n">REF1</span>      <span class="n">FE1</span>      <span class="n">QE1</span>
<span class="o">=========</span> <span class="o">====</span>      <span class="o">===</span>      <span class="o">===</span>
<span class="mi">1</span>         <span class="mf">6.3e-02</span>   <span class="mf">6.3e-02</span>  <span class="mf">6.3e-02</span>
<span class="mi">2</span>         <span class="mf">5.3e-04</span>   <span class="mf">5.3e-04</span>  <span class="mf">5.3e-04</span>
<span class="mi">3</span>         <span class="mf">3.7e-08</span>   <span class="mf">3.7e-08</span>  <span class="mf">3.7e-08</span>
<span class="mi">4</span>         <span class="mf">2.9e-16</span>   <span class="mf">2.9e-16</span>  <span class="mf">2.5e-16</span>
</pre></div>
</div>
<p>However, if quadratic elements are used to interpolate the unknown field <span class="math notranslate nohighlight">\(u\)</span>,
the order of all elements in the above forms is increased by 1. This influences
the convergence rate as seen in the table below. Clearly, using
the standard <code class="docutils literal notranslate"><span class="pre">FiniteElement</span></code> leads to a poor convergence whereas
the <code class="docutils literal notranslate"><span class="pre">QuadratureElement</span></code> still leads to quadratic convergence.</p>
<p>Relative residuals for each approach for quadratic elements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Iteration</span> <span class="n">REF2</span>      <span class="n">FE2</span>      <span class="n">QE2</span>
<span class="o">=========</span> <span class="o">====</span>      <span class="o">===</span>      <span class="o">===</span>
<span class="mi">1</span>         <span class="mf">2.6e-01</span>   <span class="mf">3.9e-01</span>  <span class="mf">2.6e-01</span>
<span class="mi">2</span>         <span class="mf">1.1e-02</span>   <span class="mf">4.6e-02</span>  <span class="mf">1.1e-02</span>
<span class="mi">3</span>         <span class="mf">1.2e-05</span>   <span class="mf">1.1e-02</span>  <span class="mf">1.6e-05</span>
<span class="mi">4</span>         <span class="mf">1.1e-11</span>   <span class="mf">7.2e-04</span>  <span class="mf">9.1e-09</span>
</pre></div>
</div>
</section>
<section id="more-examples">
<h2>More examples<a class="headerlink" href="#more-examples" title="Permalink to this heading">¶</a></h2>
<p>Feel free to send additional demo form files for your favourite PDE to
the UFL mailing list.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Unified Form Language (UFL)</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manual.html">User manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-doc/ufl.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Release notes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../manual.html">User manual</a><ul>
      <li>Previous: <a href="form_language.html" title="previous chapter">Form language</a></li>
      <li>Next: <a href="internal_representation.html" title="next chapter">Internal representation details</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2024, FEniCS Project.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/manual/examples.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>