
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Creating and using a quadrature rule &#8212; Basix 0.3.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Computing a facet integral" href="demo_facet_integral.py.html" />
    <link rel="prev" title="Creating and tabulating an element" href="demo_create_and_tabulate.py.html" />

    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="https://fenicsproject.org/assets/css/style.css">

    <link rel="apple-touch-icon" sizes="57x57" href="https://fenicsproject.org/assets/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://fenicsproject.org/assets/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://fenicsproject.org/assets/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://fenicsproject.org/assets/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://fenicsproject.org/assets/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://fenicsproject.org/assets/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://fenicsproject.org/assets/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://fenicsproject.org/assets/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://fenicsproject.org/assets/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="https://fenicsproject.org/assets/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://fenicsproject.org/assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="https://fenicsproject.org/assets/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://fenicsproject.org/assets/icons/favicon-16x16.png">
    <link rel="manifest" href="https://fenicsproject.org/assets/icons/manifest.json">
    <meta name="msapplication-TileColor" content="#555555">
    <meta name="msapplication-TileImage" content="https://fenicsproject.org/assets/icons/ms-icon-144x144.png">
    <meta name="theme-color" content="#555555">

    <link rel="stylesheet" type="text/css" href="https://fenicsproject.org/assets/css/customsty.css">

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://use.fontawesome.com/ffd23b5274.js"></script>
    <script type='text/javascript'>
document.getElementById("MathJax-script").addEventListener('load', function () {
window.MathJax = {
  tex: {
    inlineMath: [['$', '$']],
    displayMath: [['[[',']]']]
  },
  svg: {
    fontCache: 'global'
  }
}});
</script>


  
  
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


  </head><body>

<!-- HEADER -->
<div id="nav_head">
  <header class="inner" id="nav_head_inner">
    <a id="logo" href="/"><img src="https://fenicsproject.org/assets/img/fenics-logo-small.png"></a>
    <div class="top-navigation">
  <nav role="navigation" id="site-nav" class="nav">
    <ul>
      
        <li><a href="https://fenicsproject.org/people-of-fenics">People of FEniCS</a></li>
      
        <li><a href="https://fenicsproject.org/roadmap">Roadmap 2021-</a></li>
      
        <li><a href="https://fenicsproject.org/fenics-2021">FEniCS 2021</a></li>
      
        <li><a href="https://fenicsproject.org/download">Download</a></li>
      
        <li><a href="https://fenicsproject.org/documentation">Documentation</a></li>
      
        <li><a href="https://fenicsproject.org/community">Community</a></li>
      
        <li><a href="https://fenicsproject.org/governance">Governance</a></li>
      
        <li><a href="https://fenicsproject.org/citing">Citing</a></li>
      
        <li><a href="https://numfocus.salsalabs.org/donate-to-fenics/index.html">Donate</a></li>
      
    </ul>
  </nav>
</div>

  </header>
</div>

  <div id="header_wrap" class="outer" style="background-image:url(https://fenicsproject.org/assets/img/default-bg.png);background-repeat:repeat">

  <header class="inner">
  <h1 id="project_title">Basix 0.3.1.0
</h1>
  </header>
</div>


<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
  <section id="main_content" class="inner"><h2 id="project_subtitle"><a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/index.html'>Home</a>
&nbsp;
&nbsp;
<a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/install.html'>Installation</a>
&nbsp;
&nbsp;
<a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/python/demo'>Demos</a>
&nbsp;
&nbsp;
<a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/cpp'>C++ docs</a>
&nbsp;
&nbsp;
<a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/python'>Python docs</a>
</h2>  </section>
</div>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="creating-and-using-a-quadrature-rule">
<h1>Creating and using a quadrature rule<a class="headerlink" href="#creating-and-using-a-quadrature-rule" title="Permalink to this headline">¶</a></h1>
<p>This demo shows how quadrature rules can be obtained from Basix and how these
can be used to compute the integrals of functions. A quadrature rule uses a
set of points (<span class="math notranslate nohighlight">\(p_0\)</span> to <span class="math notranslate nohighlight">\(p_{n-1}\)</span>) and weights (<span class="math notranslate nohighlight">\(w_0\)</span> to
<span class="math notranslate nohighlight">\(w_{n-1}\)</span>), and approximates an integral as the weighted sum of the
values of the function at these points, ie</p>
<div class="math notranslate nohighlight">
\[\int f\,\mathrm{d}x \approx \sum_i w_if(p_i).\]</div>
<p>First, we import Basix and Numpy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">basix</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">basix</span> <span class="kn">import</span> <span class="n">ElementFamily</span><span class="p">,</span> <span class="n">CellType</span><span class="p">,</span> <span class="n">LagrangeVariant</span>
</pre></div>
</div>
<p>To get a quadrature rule on a triangle, we use the function <cite>make_quadrature</cite>.
This function takes three inputs: a quadrature rule (we use the <cite>“default”</cite>
rule); a cell type; and an order. The order of the rule is equal to the degree
of the highest degree polynomial that will be exactly integrated by this rule.
In this example, we use an order 4 rule, so all quartic polynomials will be
integrated exactly.</p>
<p><cite>make_quadrature</cite> returns two values: the points and the weights of the
quadrature rule.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">points</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">make_quadrature</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">CellType</span><span class="o">.</span><span class="n">triangle</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>We now use this quadrature rule to integrate the functions <span class="math notranslate nohighlight">\(f(x,y)=x^3y\)</span>
and <span class="math notranslate nohighlight">\(g(x,y)=x^3y^2\)</span> over the triangle. The exact values of these integrals
are 1/120 (0.00833333333333…) and 1/420 (0.00238095238095…) respectively.</p>
<p>As <span class="math notranslate nohighlight">\(f\)</span> is a degree 4 polynomial, we expect our quadrature rule to be able
to compute its integral exactly (within machine precision). <span class="math notranslate nohighlight">\(g\)</span> on the
other hand is a degree 5 polynomial, so its integral will not be computed exactly.</p>
<p>We define Python functions that compute <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> for every point.
These functions use features of Numpy to compute all the values at once.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
<p>We can now use Numpy features to compute the integrals.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">points</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="n">g</span><span class="p">(</span><span class="n">points</span><span class="p">)))</span>
</pre></div>
</div>
<p>We obtain the values 0.00833333333333334 and 0.002393509368731209. As expected,
the integral of <span class="math notranslate nohighlight">\(f\)</span> has been computed to within machine precision, while
the integral of <span class="math notranslate nohighlight">\(g\)</span> is correct to 4 decimal places, but is not exact.</p>
<section id="integrating-a-basis-function">
<h2>Integrating a basis function<a class="headerlink" href="#integrating-a-basis-function" title="Permalink to this headline">¶</a></h2>
<p>We next use the quadrature rule to compute the integral of a basis function in
a degree 3 Lagrange space. We first create the space and tabulate its basis
functions at the quadrature points.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lagrange</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span>
    <span class="n">ElementFamily</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">CellType</span><span class="o">.</span><span class="n">triangle</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">LagrangeVariant</span><span class="o">.</span><span class="n">equispaced</span><span class="p">)</span>

<span class="n">values</span> <span class="o">=</span> <span class="n">lagrange</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
</pre></div>
</div>
<p>We compute the integral of the third (note that the counting starts at 0) basis
function in this space. We can obtain the values of this basis function from
<cite>values</cite> by using the indices <cite>[0, :, 3, 0]</cite>. The integral can therefore
computed as follows. As this basis function will be degree three, the result
will again be exact (withing machine precision).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Basix</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/basix.html">basix</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="demo_create_and_tabulate.py.html">Creating and tabulating an element</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Creating and using a quadrature rule</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#integrating-a-basis-function">Integrating a basis function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="demo_facet_integral.py.html">Computing a facet integral</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_lagrange_variants.py.html">Variants of Lagrange elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_dof_transformations.py.html">DOF permutations and transformations</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Demos</a><ul>
      <li>Previous: <a href="demo_create_and_tabulate.py.html" title="previous chapter">Creating and tabulating an element</a></li>
      <li>Next: <a href="demo_facet_integral.py.html" title="next chapter">Computing a facet integral</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
  <footer class="inner">
    &copy; FEniCS Project 2021. Changes to this website can be made/suggested on <a href='https://github.com/FEniCS/web'>GitHub</a>.
  </footer>
</div>




    <div class="footer">
      &copy;2021, FEniCS Project.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/demo/demo_quadrature.py.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>