
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Creating a custom element &#8212; Basix 0.6.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Defining conforming Crouzeix–Raviart elements" href="demo_custom_element_conforming_cr.py.html" />
    <link rel="prev" title="DOF permutations and transformations" href="demo_dof_transformations.py.html" />

    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="https://fenicsproject.org/assets/css/style.css">

    <link rel="apple-touch-icon" sizes="57x57" href="https://fenicsproject.org/assets/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://fenicsproject.org/assets/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://fenicsproject.org/assets/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://fenicsproject.org/assets/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://fenicsproject.org/assets/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://fenicsproject.org/assets/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://fenicsproject.org/assets/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://fenicsproject.org/assets/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://fenicsproject.org/assets/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="https://fenicsproject.org/assets/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://fenicsproject.org/assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="https://fenicsproject.org/assets/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://fenicsproject.org/assets/icons/favicon-16x16.png">
    <link rel="manifest" href="https://fenicsproject.org/assets/icons/manifest.json">
    <meta name="msapplication-TileColor" content="#555555">
    <meta name="msapplication-TileImage" content="https://fenicsproject.org/assets/icons/ms-icon-144x144.png">
    <meta name="theme-color" content="#555555">

    <link rel="stylesheet" type="text/css" href="https://fenicsproject.org/assets/css/customsty.css">

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://kit.fontawesome.com/5506de0e1b.js" crossorigin="anonymous"></script>
    <script type='text/javascript'>
document.getElementById("MathJax-script").addEventListener('load', function () {
window.MathJax = {
  tex: {
    inlineMath: [['$', '$']],
    displayMath: [['[[',']]']]
  },
  svg: {
    fontCache: 'global'
  }
}});
</script>


  
  
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


  </head><body>

<!-- HEADER -->
<div id="nav_head">
  <header class="inner" id="nav_head_inner">
    <a id="logo" href="/"><img src="https://fenicsproject.org/assets/img/fenics-logo-small.png"></a>
    <div class="top-navigation">
  <nav role="navigation" id="site-nav" class="nav">
    <ul>
      
        <li><a href="https://fenicsproject.org/fenics-2022">FEniCS 2022</a></li>
      
        <li><a href="https://fenicsproject.org/download">Download</a></li>
      
        <li><a href="https://fenicsproject.org/documentation">Documentation</a></li>
      
        <li><a href="https://fenicsproject.org/community">Community</a></li>
      
        <li><a href="https://fenicsproject.org/citing">Citing</a></li>
      
        <li><a href="https://numfocus.salsalabs.org/donate-to-fenics/index.html">Donate</a></li>
      
    </ul>
  </nav>
</div>

  </header>
</div>

  <div id="header_wrap" class="outer" style="background-image:url(https://fenicsproject.org/assets/img/default-bg.png);background-repeat:repeat">

  <header class="inner">
  <h1 id="project_title">Basix 0.6.0.0
</h1>
  </header>
</div>


<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
  <section id="main_content" class="inner"><h2 id="project_subtitle"><a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/index.html'>Home</a>
&nbsp;
&nbsp;
<a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/install.html'>Installation</a>
&nbsp;
&nbsp;
<a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/python/demo'>Demos</a>
&nbsp;
&nbsp;
<a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/cpp'>C++ docs</a>
&nbsp;
&nbsp;
<a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/python'>Python docs</a>
</h2>  </section>
</div>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="creating-a-custom-element">
<h1>Creating a custom element<a class="headerlink" href="#creating-a-custom-element" title="Permalink to this heading">¶</a></h1>
<p>In Basix, it is possible to create custom finite elements. This demo describes
how to do this and what data you need to provide when creating a custom element.</p>
<p>First, we import Basix and Numpy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">basix</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">basix</span> <span class="kn">import</span> <span class="n">CellType</span><span class="p">,</span> <span class="n">MapType</span><span class="p">,</span> <span class="n">PolynomialType</span><span class="p">,</span> <span class="n">LatticeType</span><span class="p">,</span> <span class="n">SobolevSpace</span>
</pre></div>
</div>
<section id="lagrange-element-with-bubble">
<h2>Lagrange element with bubble<a class="headerlink" href="#lagrange-element-with-bubble" title="Permalink to this heading">¶</a></h2>
<p>As a first example, we create a degree 1 Lagrange element with a quadratic bubble
on a quadrilateral cell. This element will span the following set of polynomials:</p>
<div class="math notranslate nohighlight">
\[\left\{1,\; y,\; x,\; xy,\; x(1-x)y(1-y)\right\}.\]</div>
<p>We will define the degrees of freedom (DOFs) of this element by placing a point
evaluation at each vertex, plus one at the midpoint of the cell.</p>
<section id="polynomial-coefficients">
<h3>Polynomial coefficients<a class="headerlink" href="#polynomial-coefficients" title="Permalink to this heading">¶</a></h3>
<p>When creating a custom element, we must input the coefficients that define
a basis of the set of polynomials that our element spans. In this example,
we will represent the 5 functions above in terms of the 9 orthogonal polynomials
of degree <span class="math notranslate nohighlight">\(\leqslant2\)</span> on a quadrilateral, so we create a 5 by 9 matrix.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wcoeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
<p>The degree 2 orthonormal polynomials for a quadrilateral will have their highest
degree terms in the following order:</p>
<div class="math notranslate nohighlight">
\[1,\; y,\; y^2,\; x,\; xy,\; xy^2,\; x^2,\; x^2y,\; x^2y^2\]</div>
<p>The order in which the polynomials appear in the orthonormal polynomial sets for
each cell are documented at
<a class="reference external" href="https://docs.fenicsproject.org/basix/main/polyset-order.html">https://docs.fenicsproject.org/basix/main/polyset-order.html</a>.</p>
<p>As our polynomial space contains 1, <span class="math notranslate nohighlight">\(y\)</span>, <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(xy\)</span>. The first
four rows of the matrix contain a single 1 for the four orthogonal polynomials with
these are their highest degree terms.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wcoeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">wcoeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">wcoeffs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">wcoeffs</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The final row of the matrix defines the polynomials <span class="math notranslate nohighlight">\(x(1-x)y(1-y)\)</span>. As the polynomials
are orthonormal, we can represent this as</p>
<div class="math notranslate nohighlight">
\[x(1-x)y(1-y) = \sum_{i=0}^8\int_0^1\int_0^1p_i(x, y)x(1-x)y(1-y)\,\mathrm{d}x\,\mathrm{d}y\; p_i(x, y),\]</div>
<p>where <span class="math notranslate nohighlight">\(p_0\)</span> to <span class="math notranslate nohighlight">\(p_8\)</span> are the orthonormal polynomials. Therefore the coefficients we want
to put in the final row of our matrix are:</p>
<div class="math notranslate nohighlight">
\[\int_0^1\int_0^1p_i(x, y)x(1-x)y(1-y)\,\mathrm{d}x\,\mathrm{d}y.\]</div>
<p>We compute these integrals using a degree 4 quadrature rule (this is the largest degree
that the integrand will be, so these integrals will be exact).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pts</span><span class="p">,</span> <span class="n">wts</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">make_quadrature</span><span class="p">(</span><span class="n">CellType</span><span class="o">.</span><span class="n">quadrilateral</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">poly</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">tabulate_polynomials</span><span class="p">(</span><span class="n">PolynomialType</span><span class="o">.</span><span class="n">legendre</span><span class="p">,</span> <span class="n">CellType</span><span class="o">.</span><span class="n">quadrilateral</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pts</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">wcoeffs</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">f</span> <span class="o">*</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">wts</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="interpolation">
<h3>Interpolation<a class="headerlink" href="#interpolation" title="Permalink to this heading">¶</a></h3>
<p>Next, we compute the points and matrices that define how functions can be interpolated
into this space. These are representations of the functionals that are used in the
Ciarlet definition of the finite element – in this example, these are evaluations
at the points described above.</p>
<p>First, we define the points. We create an array of points for each entity of each
dimension. For each vertex of the cell, we include the coordinates of that vertex.
For the interior of the cell, we include a point at <span class="math notranslate nohighlight">\((0.5,0.5)\)</span>.</p>
<p>The shape of each of the point lists is (number of points, dimension).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]]</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]))</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]))</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]))</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]))</span>
<span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]]))</span>
</pre></div>
</div>
<p>There are no DOFs associates with the edges for this element, so we add an empty
array of points for each edge.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>We then define the interpolation matrices that define how the evaluations at the points
are combined to evaluate the functionals. As all the DOFs are point evaluations in this
example, the matrices are all identity matrices for the entities that have a point.</p>
<p>The shape of each matrix is (number of DOFs, value size, number of points, number of
derivatives).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[[</span><span class="mf">1.</span><span class="p">]]]]))</span>
<span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[[</span><span class="mf">1.</span><span class="p">]]]]))</span>
</pre></div>
</div>
<p>There are no DOFs associates with the edges for this element, so we add an empty
matrix for each edge.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
</section>
<section id="creating-the-element">
<h3>Creating the element<a class="headerlink" href="#creating-the-element" title="Permalink to this heading">¶</a></h3>
<p>We now create the custom element. The inputs into <cite>basix.create_custom_element</cite> are:</p>
<ul class="simple">
<li><p>The cell type. In this example, this is a quadrilateral.</p></li>
<li><p>The value shape of the element. In this example, this is <cite>[]</cite> as the element is scalar.</p></li>
<li><p>The coefficients that define the polynomial set. In this example, this is <cite>wcoeffs</cite>.</p></li>
<li><p>The points used to define interpolation into the element. In this example, this is <cite>x</cite>.</p></li>
<li><p>The matrix used to define interpolation into the element. In this example, this is <cite>M</cite>.</p></li>
<li><p>The number of derivates used in the evaluation of the functionals. In this example, this
is 0.</p></li>
<li><p>The map type. In this example, this is the identity map.</p></li>
<li><p>The underlying Sobolev space. In this example, this is H1.</p></li>
<li><p>A bool indicating whether the element is discontinuous. In this example, this is <cite>False</cite>.</p></li>
<li><p>The highest degree <span class="math notranslate nohighlight">\(n\)</span> such that all degree <span class="math notranslate nohighlight">\(n\)</span> polynomials are contained in
this set. In this example, this is 1.</p></li>
<li><p>The highest degree of a polynomial in the element. In this example, this is 2. It is
important that this value is correct, as it will be used to determine the number of
polynomials to use when creating and tabulating the element.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">create_custom_element</span><span class="p">(</span>
    <span class="n">CellType</span><span class="o">.</span><span class="n">quadrilateral</span><span class="p">,</span> <span class="p">[],</span> <span class="n">wcoeffs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MapType</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span> <span class="n">SobolevSpace</span><span class="o">.</span><span class="n">H1</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>We can now use this element in the same way we can use a built-in element. For example, we
can tabulate the element at a set of points. If the points we use are the same as the points
we used to define the DOFs, we see that each basis function is equal to 1 at one of these points,
and equal to zero at all the other points.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">points</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="degree-1-ravairt-thomas-element">
<h2>Degree 1 Ravairt–Thomas element<a class="headerlink" href="#degree-1-ravairt-thomas-element" title="Permalink to this heading">¶</a></h2>
<p>As a second example, we create a degree 1 Raviart–Thomas element on a triangle. Details of
the definition of this element can be found at
<a class="reference external" href="https://defelement.com/elements/raviart-thomas.html">https://defelement.com/elements/raviart-thomas.html</a>. This element
spans:</p>
<div class="math notranslate nohighlight">
\[\left\{(1, 0),\; (0, 1),\; (x, y)\right\}.\]</div>
<p>The DOFs of this element are integrals along each edge of the cell of the dot product of the
function with the normal to the edge.</p>
<p>In contrast to the scalar-valued element above, this element has a value size of 2.</p>
<section id="id1">
<h3>Polynomial coefficients<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<p>In this example, we will represent the 3 functions above in terms of the 3 orthogonal
polynomials of degree <span class="math notranslate nohighlight">\(\leqslant1\)</span> on a triangle in each of the two coordinate directions.
We therefore create a 3 by 6 matrix.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wcoeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
<p>The highest degree terms in each polynomial will be:</p>
<div class="math notranslate nohighlight">
\[(1, 0),\; (x, 0),\; (y, 0),\; (0, 1),\; (0, x),\; (0, y)\]</div>
<p>We include <span class="math notranslate nohighlight">\((1,0)\)</span> and <span class="math notranslate nohighlight">\((0,1)\)</span> as the first two rows of the matrix, and use
integrals to represent <span class="math notranslate nohighlight">\((x,y)\)</span> as in the previous example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wcoeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">wcoeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">pts</span><span class="p">,</span> <span class="n">wts</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">make_quadrature</span><span class="p">(</span><span class="n">CellType</span><span class="o">.</span><span class="n">triangle</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">poly</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">tabulate_polynomials</span><span class="p">(</span><span class="n">PolynomialType</span><span class="o">.</span><span class="n">legendre</span><span class="p">,</span> <span class="n">CellType</span><span class="o">.</span><span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pts</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">wcoeffs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">wts</span><span class="p">)</span>
    <span class="n">wcoeffs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">wts</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Interpolation<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<p>For this element, there will be multiple points used per DOF, as the functionals that define
the element are integrals. We begin by defining a degree 1 quadrature rule on an interval.
This quadrature rule will be used to integrate on the edges of the triangle.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pts</span><span class="p">,</span> <span class="n">wts</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">make_quadrature</span><span class="p">(</span><span class="n">CellType</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The points associated with each edge are calculated by mapping the quadrature points to each edge.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">]))</span>
<span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">]))</span>
<span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">]))</span>
<span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>The interpolation matrices for the edges in this example will be have shape (1, 2, len(pts), 1),
as there is one DOF per edge, the value size is 2, and we have len(pts) quadrature points on each
edge, and no extra derivatives are used. The entries of these matrices are the quadrature weights
multiplied by the normal directions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">normal</span> <span class="ow">in</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]:</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wts</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">wts</span>
    <span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">normal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">wts</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3>Creating the element<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">create_custom_element</span><span class="p">(</span>
    <span class="n">CellType</span><span class="o">.</span><span class="n">triangle</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">wcoeffs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MapType</span><span class="o">.</span><span class="n">contravariantPiola</span><span class="p">,</span> <span class="n">SobolevSpace</span><span class="o">.</span><span class="n">HDiv</span><span class="p">,</span>
    <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>To confirm that we have defined this element correctly, we compare it to the built-in
Raviart–Thomas element.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rt</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">basix</span><span class="o">.</span><span class="n">ElementFamily</span><span class="o">.</span><span class="n">RT</span><span class="p">,</span> <span class="n">CellType</span><span class="o">.</span><span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">points</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">create_lattice</span><span class="p">(</span><span class="n">CellType</span><span class="o">.</span><span class="n">triangle</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">LatticeType</span><span class="o">.</span><span class="n">equispaced</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">points</span><span class="p">),</span> <span class="n">element</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">points</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Basix</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/basix.html">basix</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="demo_create_and_tabulate.py.html">Creating and tabulating an element</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_quadrature.py.html">Creating and using a quadrature rule</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_facet_integral.py.html">Computing a facet integral</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_lagrange_variants.py.html">Variants of Lagrange elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_dof_transformations.py.html">DOF permutations and transformations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Creating a custom element</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lagrange-element-with-bubble">Lagrange element with bubble</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#polynomial-coefficients">Polynomial coefficients</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interpolation">Interpolation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-the-element">Creating the element</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#degree-1-ravairt-thomas-element">Degree 1 Ravairt–Thomas element</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Polynomial coefficients</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Interpolation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">Creating the element</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="demo_custom_element_conforming_cr.py.html">Defining conforming Crouzeix–Raviart elements</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Demos</a><ul>
      <li>Previous: <a href="demo_dof_transformations.py.html" title="previous chapter">DOF permutations and transformations</a></li>
      <li>Next: <a href="demo_custom_element_conforming_cr.py.html" title="next chapter">Defining conforming Crouzeix–Raviart elements</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
  <footer class="inner">
    &copy; FEniCS Project 2021. Changes to this website can be made/suggested on <a href='https://github.com/FEniCS/web'>GitHub</a>.
  </footer>
</div>




    <div class="footer">
      &copy;2022, FEniCS Project.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/demo/demo_custom_element.py.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>