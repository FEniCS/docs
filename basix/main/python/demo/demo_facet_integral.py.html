<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Computing a facet integral &#8212; Basix 0.10.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=c058f7c8" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=15ca63c5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Variants of Lagrange elements" href="demo_lagrange_variants.py.html" />
    <link rel="prev" title="Creating and using a quadrature rule" href="demo_quadrature.py.html" />

    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="https://fenicsproject.org/assets/css/style.css?v=2023-12-11">

    <link rel="apple-touch-icon" sizes="57x57" href="https://fenicsproject.org/assets/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://fenicsproject.org/assets/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://fenicsproject.org/assets/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://fenicsproject.org/assets/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://fenicsproject.org/assets/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://fenicsproject.org/assets/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://fenicsproject.org/assets/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://fenicsproject.org/assets/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://fenicsproject.org/assets/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="https://fenicsproject.org/assets/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://fenicsproject.org/assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="https://fenicsproject.org/assets/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://fenicsproject.org/assets/icons/favicon-16x16.png">
    <link rel="manifest" href="https://fenicsproject.org/assets/icons/manifest.json">
    <meta name="msapplication-TileColor" content="#555555">
    <meta name="msapplication-TileImage" content="https://fenicsproject.org/assets/icons/ms-icon-144x144.png">
    <meta name="theme-color" content="#555555">

    <link rel="stylesheet" type="text/css" href="https://fenicsproject.org/assets/css/customsty.css">
   <link rel="stylesheet" type="text/css" href="/assets/sty.css">

    <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://fenicsproject.org/assets/fontawesome/js/fontawesome.js"></script>
    <script src="https://fenicsproject.org/assets/fontawesome/js/brands.js"></script>
    <script src="https://fenicsproject.org/assets/fontawesome/js/solid.js"></script>
    <script type='text/javascript'>
document.getElementById("MathJax-script").addEventListener('load', function () {
window.MathJax = {
  tex: {
    inlineMath: [['$', '$']],
    displayMath: [['[[',']]']]
  },
  svg: {
    fontCache: 'global'
  }
}});
</script>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Basix 0.10.0.0 | FEniCS Project</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Basix 0.10.0.0" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Open-source finite element library" />
<meta property="og:description" content="Open-source finite element library" />
<link rel="canonical" href="https://fenicsproject.org/template.html" />
<meta property="og:url" content="https://fenicsproject.org/template.html" />
<meta property="og:site_name" content="FEniCS Project" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Basix 0.10.0.0" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Open-source finite element library","headline":"Basix 0.10.0.0","url":"https://fenicsproject.org/template.html"}</script>
<!-- End Jekyll SEO tag -->

  
  
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  


  </head><body>

<!-- HEADER -->
<div id="nav_head">
  <header class="inner" id="nav_head_inner">
    <a id="logo" href="https://fenicsproject.org/"><img src="https://fenicsproject.org/assets/img/fenics-logo-small.png"></a>
    <div class="top-navigation">
  <nav role="navigation" id="site-nav" class="nav">
    <ul>
      
        <li><a href="https://fenicsproject.org/">Home</a></li>
      
        <li><a href="https://fenicsproject.org/fenics-2025">FEniCS 2025</a></li>
      
        <li><a href="https://fenicsproject.org/download">Download</a></li>
      
        <li><a href="https://fenicsproject.org/documentation">Documentation</a></li>
      
        <li><a href="https://fenicsproject.org/community">Community</a></li>
      
        <li><a href="https://fenicsproject.org/citing">Citing</a></li>
      
        <li><a href="https://numfocus.org/donate-to-fenics"><i class="fa-solid fa-arrow-up-right-from-square"></i> Donate</a></li>
      
    </ul>
  </nav>
</div>

  </header>
</div>

  <div id="header_wrap" class="outer" style="background-image:url(https://fenicsproject.org/assets/img/headers/fenics_fire.png);background-repeat:repeat">

  <header class="inner lesstall">

  <h1 id="project_title">Basix 0.10.0.0</h1>

  </header>
</div>


<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
  <section id="main_content" class="inner">
    
    <h2 id="project_subtitle"><a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/index.html'>Home</a>
&nbsp;
&nbsp;
<a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/install.html'>Installation</a>
&nbsp;
&nbsp;
<a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/python/demo'>Demos</a>
&nbsp;
&nbsp;
<a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/cpp'>C++ docs</a>
&nbsp;
&nbsp;
<a class='fenicsnav' href='https://docs.fenicsproject.org/basix/main/python'>Python docs</a>
</h2>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="computing-a-facet-integral">
<h1>Computing a facet integral<a class="headerlink" href="#computing-a-facet-integral" title="Link to this heading">¶</a></h1>
<p>In this demo, we look at how Basix can be used to compute the integral
of the normal derivative of a basis function over a triangular facet
of a tetrahedral cell.</p>
<p>As an example, we integrate the normal derivative of the fifth basis
function (note: counting starts at 0) of a degree 3 Lagrange space
over the zeroth facet of a tetrahedral cell. This facet will have
vertices at (1,0,0), (0,1,0) and (0,0,1).</p>
<p>We start by importing Basis and Numpy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">basix</span>
<span class="kn">from</span> <span class="nn">basix</span> <span class="kn">import</span> <span class="n">CellType</span><span class="p">,</span> <span class="n">ElementFamily</span><span class="p">,</span> <span class="n">LagrangeVariant</span>
</pre></div>
</div>
<p>We define a degree 3 Lagrange space on a tetrahedron.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lagrange</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span>
    <span class="n">ElementFamily</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">CellType</span><span class="o">.</span><span class="n">tetrahedron</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">LagrangeVariant</span><span class="o">.</span><span class="n">equispaced</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The facets of a tetrahedron are triangular, so we create a quadrature
rule on a triangle. We use an order 3 rule so that we can integrate the
basis functions in our space exactly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">points</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">make_quadrature</span><span class="p">(</span><span class="n">CellType</span><span class="o">.</span><span class="n">triangle</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we must map the quadrature points to our facet. We use the function
<cite>geometry</cite> to get the coordinates of the vertices of the tetrahedron, and
we use <cite>sub_entity_connectivity</cite> to see which vertices are adjacent to
our facet. We get the sub-entity connectivity using the indices 2 (facets
of 3D cells have dimension 2), 0 (vertices have dimension 0), and 0 (the
index of the facet we chose to use).</p>
<p>Using this information, we can map the quadrature points to the facet.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vertices</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="n">CellType</span><span class="o">.</span><span class="n">tetrahedron</span><span class="p">)</span>
<span class="n">facet</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">sub_entity_connectivity</span><span class="p">(</span><span class="n">CellType</span><span class="o">.</span><span class="n">tetrahedron</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">mapped_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">vertices</span><span class="p">[</span><span class="n">facet</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">vertices</span><span class="p">[</span><span class="n">facet</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">vertices</span><span class="p">[</span><span class="n">facet</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">*</span> <span class="n">y</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">points</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We now compute the normal derivative of the fifth basis function at
the quadrature points. First, we use <cite>facet_outward_normals</cite> to get
the normal vector to the facet.</p>
<p>We then tabulate the basis functions of our space at the quadrature
points. We pass 1 in as the first argument, as we want the derivatives
of the basis functions. The result of tabulation will be an array of
size 4 by number of quadrature points by number of degrees of freedom.
To get the data that we want, we use the indices <cite>1:</cite> (to get the
derivatives and not also the function values), <cite>:</cite> (to include every
point), 5 (to get the fifth basis function), and 0 (to get the only
entry as the value size is 1).</p>
<p>We then multiply the three derivatives of the basis function by
the three components of the normal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normal</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">facet_outward_normals</span><span class="p">(</span><span class="n">CellType</span><span class="o">.</span><span class="n">tetrahedron</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">tab</span> <span class="o">=</span> <span class="n">lagrange</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mapped_points</span><span class="p">)[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">normal_deriv</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">tab</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tab</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>As our facet is not the reference triangle, we must multiply the
integrand by the norm of the Jacobian. We compute this by taking the
cross product of the two columns of the Jacobian, and then compute
the integral.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jacobian</span> <span class="o">=</span> <span class="n">basix</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">facet_jacobians</span><span class="p">(</span><span class="n">CellType</span><span class="o">.</span><span class="n">tetrahedron</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">size_jacobian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">jacobian</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">jacobian</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">normal_deriv</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span> <span class="o">*</span> <span class="n">size_jacobian</span><span class="p">)</span>
</pre></div>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Basix</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/basix.html">basix</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="demo_create_and_tabulate.py.html">Creating and tabulating an element</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_quadrature.py.html">Creating and using a quadrature rule</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Computing a facet integral</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_lagrange_variants.py.html">Variants of Lagrange elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_dof_transformations.py.html">DOF permutations and transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_custom_element.py.html">Creating a custom element</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_custom_element_conforming_cr.py.html">Defining conforming Crouzeix–Raviart elements</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Demos</a><ul>
      <li>Previous: <a href="demo_quadrature.py.html" title="previous chapter">Creating and using a quadrature rule</a></li>
      <li>Next: <a href="demo_lagrange_variants.py.html" title="next chapter">Variants of Lagrange elements</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>


  </section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
  <footer class="inner">
    &copy; FEniCS Project 2024. Changes to this website can be made/suggested on <a href='https://github.com/FEniCS/web'>GitHub</a>.
  </footer>
</div>




    <div class="footer">
      &#169;2024, FEniCS Project.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.0.2</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/demo/demo_facet_integral.py.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>